/**
 * C10n transforms plugin.
 *
 * Vite is not aware of this config file's location.
 *
 * @note PLEASE DO NOT EDIT THIS FILE!
 * @note This entire file will be updated automatically.
 * @note Instead of editing here, please review <https://github.com/clevercanyon/skeleton>.
 */

/**
 * Configures Vite/Rollup transforms.
 *
 * @param   props Props from vite config file driver.
 *
 * @returns       Plugin configuration.
 */
export default async (/* {} */) => {
    return {
        name: 'vite-plugin-c10n-transforms',

        async transform(/* Rollup hook. */ unusedꓺ, id) {
            /**
             * If `moduleSideEffects` is set to `false` and no other module imports anything from the module, then the
             * module will not be included even if the module would have side effects; {@see https://o5p.me/EcB2d6}.
             *
             * We explicitly flag `@preact/signals`, `@preact/signals-core` as not having side-effects, such that they
             * won’t be added to our bundle simply because our `$preact` utilities export them. In truth, these do have
             * side-effects, but we don’t care about the side-effects unless we are actually using `@preact/signals`.
             */
            if (/@preact\/signals(?:-core)?\b/iu.test(id)) {
                return { moduleSideEffects: false };
            }
            return null; // No transform.
        },
    };
};
