/**
 * Dependency optimizer config file.
 *
 * Vite is not aware of this config file's location.
 *
 * @note PLEASE DO NOT EDIT THIS FILE!
 * @note This entire file will be updated automatically.
 * @note Instead of editing here, please review <https://github.com/clevercanyon/skeleton>.
 *
 * @see https://vite.dev/config/dep-optimization-options.html
 */

import viteMDXESBuildConfig from '../mdx/esbuild.mjs';

/**
 * Configures dependency optimizer for Vite.
 *
 * @param   props Props from vite config file driver.
 *
 * @returns       Dependency optimizer configuration.
 */
export default async ({ projDir, pkg, wranglerSettings, prefreshEnable }) => ({
    force: true, // Force recreation; i.e., donâ€™t cache.

    include: [
        ...(prefreshEnable
            ? [
                  'preact', //
                  'preact/hooks',
                  'preact/compat',
                  'preact/jsx-runtime',
                  '@preact/signals',
              ]
            : []),
    ].filter((name) => name !== pkg.name && !name.startsWith(pkg.name + '/')),

    exclude: [
        ...wranglerSettings.runtimeModules, //
        ...wranglerSettings.virtualModules,
    ],
    esbuildOptions: {
        plugins: [await viteMDXESBuildConfig({ projDir })],
    },
});
