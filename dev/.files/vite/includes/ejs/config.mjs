/**
 * EJS config file.
 *
 * EJS is not aware of this config file's location.
 *
 * @note PLEASE DO NOT EDIT THIS FILE!
 * @note This entire file will be updated automatically.
 * @note Instead of editing here, please review <https://github.com/clevercanyon/skeleton>.
 *
 * @see https://github.com/trapcodeio/vite-plugin-ejs
 */

import { createRequire } from 'node:module';
import path from 'node:path';

/**
 * Configures EJS for Vite.
 *
 * @param   props Props from vite config file driver.
 *
 * @returns       EJS configuration.
 */
export default async ({ mode, projDir, srcDir, pkg, env }) => {
	const require = createRequire(import.meta.url);

	return (await import('vite-plugin-ejs')).ViteEjsPlugin(
		{ $: { require, pkg, mode, env, projDir } },
		{
			// EJS is enabled for `index.{html}` entry points.

			ejs: /* <https://o5p.me/wGv5nM> */ {
				strict: true, // JS strict mode.
				async: true, // Support await in EJS files.

				delimiter: '?', // <https://o5p.me/Qwu3af>.
				localsName: '$', // Shorter name for `locals`.
				outputFunctionName: 'echo', // For output in scriptlets.

				root: [srcDir], // For includes with an absolute path.
				views: /* For includes with a relative path â€” includes utilities. */ [
					//
					path.resolve(srcDir, './resources/ejs-views'), // Our standard location for internal EJS views.
					path.resolve(srcDir, './cargo/assets/ejs-views'), // Our standard location for distributed EJS views.
				],
			},
		},
	);
};
