/**
 * Static configuration.
 *
 * Vite is not aware of this config file's location.
 *
 * @note PLEASE DO NOT EDIT THIS FILE!
 * @note This entire file will be updated automatically.
 * @note Instead of editing here, please review <https://github.com/clevercanyon/skeleton>.
 *
 * @see https://vite.dev/config/shared-options.html#define
 */

import { $is, $str } from '../../../../../../../node_modules/@clevercanyon/utilities/dist/index.js';
import u from '../../../../../resources/utilities.mjs';

/**
 * Configures static definitions.
 *
 * @param   props Props from vite config file driver.
 *
 * @returns       Static configuration.
 */
export default async ({ time, appEnvPrefixes, env, appBaseURL, appBaseURLResolvedNTS }) => {
    const staticDefs = {
        ['$$__' + appEnvPrefixes[0] + 'PKG_NAME__$$']: u.pkgName,
        ['$$__' + appEnvPrefixes[0] + 'PKG_VERSION__$$']: u.pkgVersion,

        ['$$__' + appEnvPrefixes[0] + 'BUILD_TIME_YMD__$$']: time.toYMD(),
        ['$$__' + appEnvPrefixes[0] + 'BUILD_TIME_SQL__$$']: time.toSQL(),
        ['$$__' + appEnvPrefixes[0] + 'BUILD_TIME_ISO__$$']: time.toISO(),
        ['$$__' + appEnvPrefixes[0] + 'BUILD_TIME_STAMP__$$']: time.unix().toString(),

        ['$$__' + appEnvPrefixes[0] + 'BASE_URL__$$']: appBaseURL,
        ['$$__' + appEnvPrefixes[0] + 'BASE_URL_RESOLVED_NTS__$$']: appBaseURLResolvedNTS,
    };
    Object.keys(env) // Add string env vars to static defines.
        .filter((key) => new RegExp('^(?:' + appEnvPrefixes.map((v) => $str.escRegExp(v)).join('|') + ')', 'u').test(key))
        .filter((key) => $is.string($str.parseValue(env[key])) /* Only those which are truly string values. */)
        .forEach((key) => (staticDefs['$$__' + key + '__$$'] = env[key]));

    return { staticDefs };
};
