/**
 * Rehype plugin.
 *
 * @note PLEASE DO NOT EDIT THIS FILE!
 * @note This entire file will be updated automatically.
 * @note Instead of editing here, please review <https://github.com/clevercanyon/skeleton>.
 */

import { visit as unistVisit } from 'unist-util-visit';

/**
 * Modifies hash-only anchors so they work well with `<base href>` in our preact apps.
 */
export default () => {
    return (tree) => {
        unistVisit(tree, 'element', (node) => {
            if ('a' === node.tagName && node.properties.href?.startsWith('#')) {
                node.tagName = 'x-hash'; // `CustomHTMLHashElement`.

                // Gives these a proper role and tabIndex for a11y.
                node.properties.role = node.properties.role || 'link';
                node.properties.tabIndex = node.properties.tabIndex || 0;

                // Styles custom element `<x-hash>` just like `<a>` using our own `.link` class.
                node.properties.class = (node.properties.class || []).concat(node.properties.className || []).concat(['link']);
                delete node.properties.className; // Removes `className` in favor of `class`.
            }
            return node;
        });
    };
};
